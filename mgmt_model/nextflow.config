/*
 * Nextflow configuration file for MGMT Methylation Detection Pipeline
 */

// Pipeline metadata
manifest {
    name = 'mgmt-methylation-detection'
    author = 'MGMT Pipeline Team'
    description = 'Genome-wide methylation analysis for MGMT status prediction'
    version = '1.0.0'
    homePage = 'https://github.com/your-repo/mgmt-pipeline'
    mainScript = 'main.nf'
    nextflowVersion = '>=22.0.0'
}

// Default parameters
params {
    // Input/Output
    input = null
    metadata = null
    outdir = 'results'
    
    // Data processing
    min_coverage = 3
    modification_types = 'm'
    chromosomes = null
    
    // Feature engineering
    window_sizes = '1000,5000,10000,50000'
    scaling_method = 'robust'
    
    // Model training
    feature_selection = true
    n_features = 50
    hyperparameter_tuning = true
    create_ensemble = true
    
    // Resource limits
    max_memory = '16.GB'
    max_cpus = 8
    max_time = '24.h'
    
    // Help
    help = false
}

// Process configurations
process {
    // Default process configuration
    cpus = 1
    memory = 4.GB
    time = 2.h
    
    // Process-specific configurations
    withName: LOAD_DATA {
        cpus = 1
        memory = 8.GB
        time = 1.h
    }
    
    withName: EXTRACT_FEATURES {
        cpus = 2
        memory = 12.GB
        time = 4.h
    }
    
    withName: TRAIN_MODELS {
        cpus = 4
        memory = 16.GB
        time = 8.h
    }
    
    withName: EVALUATE_MODELS {
        cpus = 2
        memory = 8.GB
        time = 2.h
    }
    
    withName: PREDICT_SAMPLES {
        cpus = 1
        memory = 4.GB
        time = 1.h
    }
    
    withName: GENERATE_REPORT {
        cpus = 1
        memory = 2.GB
        time = 30.min
    }
}

// Execution profiles
profiles {
    
    // Standard profile (default)
    standard {
        process.executor = 'local'
    }
    
    // Docker profile
    docker {
        docker.enabled = true
        docker.userEmulation = true
        process.container = 'python:3.9-slim'
    }
    
    // Singularity profile
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        process.container = 'docker://python:3.9-slim'
    }
    
    // Conda profile
    conda {
        conda.enabled = true
        process.conda = "${projectDir}/environment.yml"
    }
    
    // HPC SLURM profile
    slurm {
        process.executor = 'slurm'
        process.queue = 'normal'
        process.clusterOptions = '--account=your_account'
        
        // Increase resources for cluster
        process {
            withName: LOAD_DATA {
                cpus = 2
                memory = 16.GB
                time = 2.h
            }
            
            withName: EXTRACT_FEATURES {
                cpus = 4
                memory = 24.GB
                time = 6.h
            }
            
            withName: TRAIN_MODELS {
                cpus = 8
                memory = 32.GB
                time = 12.h
            }
        }
    }
    
    // PBS profile
    pbs {
        process.executor = 'pbs'
        process.queue = 'workq'
    }
    
    // SGE profile
    sge {
        process.executor = 'sge'
        process.queue = 'all.q'
    }
    
    // AWS Batch profile
    awsbatch {
        process.executor = 'awsbatch'
        process.queue = 'your-batch-queue'
        aws.region = 'us-east-1'
        workDir = 's3://your-bucket/work'
    }
    
    // Test profile (for quick testing)
    test {
        params.min_coverage = 1
        params.n_features = 10
        params.hyperparameter_tuning = false
        
        process {
            withName: TRAIN_MODELS {
                cpus = 1
                memory = 4.GB
                time = 30.min
            }
        }
    }
}

// Resource limits
executor {
    queueSize = 20
    submitRateLimit = '10/1min'
}

// Timeline and reports
timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/dag.svg"
}

// Error handling
process.errorStrategy = 'retry'
process.maxRetries = 3

// Cleanup
cleanup = true

